<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†å²å¹´è¡¨</title>
    <link rel="stylesheet" href="timeline.css">
    <link rel="stylesheet" href="mobile.css">
    <link rel="preload" href="data/events.js" as="script">
    <link rel="preload" href="data/characters.js" as="script">
    <link rel="preload" href="timeline-optimized.js" as="script">
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- åŠ è½½é®ç½©å±‚ï¼šé¡µé¢åŠ è½½æ—¶æ˜¾ç¤º -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">æ­£åœ¨åŠ è½½...</div>
        </div>

        <!-- Toasté€šçŸ¥å®¹å™¨ï¼šæ˜¾ç¤ºæˆåŠŸ/é”™è¯¯æ¶ˆæ¯ -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- å›ºå®šé¡¶éƒ¨æ ï¼šåŒ…å«æ ‡é¢˜ã€å‰¯æ ‡é¢˜å’Œæ§åˆ¶æŒ‰é’® -->
        <nav class="fixed-nav-bar">
            <!-- æ ‡é¢˜åŒºåŸŸï¼šå±…ä¸­æ˜¾ç¤º -->
            <div class="header">
                <h1 class="title">å†å²å¹´è¡¨</h1>
                <p class="subtitle">æ¢ç´¢å†å²çš„é•¿æ²³</p>
            </div>
            <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
            <div class="nav-controls">
                <!-- äº‹ä»¶ç±»å‹ç­›é€‰å™¨ï¼šæŒ‰æ”¿æ²»ã€æ–‡åŒ–ã€ç§‘æŠ€ã€å†›äº‹ç­›é€‰ -->
                <select class="filter-select" id="categoryFilter">
                    <option value="all">å…¨éƒ¨ç±»å‹</option>
                    <option value="political">æ”¿æ²»</option>
                    <option value="cultural">æ–‡åŒ–</option>
                    <option value="technology">ç§‘æŠ€</option>
                    <option value="military">å†›äº‹</option>
                </select>
                <!-- äººç‰©åˆ†ç±»ç­›é€‰å™¨ï¼šæŒ‰æ”¿æ²»å®¶ã€å†›äº‹å®¶ã€ç§‘å­¦å®¶ã€æ–‡å­¦å®¶ã€å“²å­¦å®¶ç­›é€‰ -->
                <select class="filter-select" id="characterCategoryFilter">
                    <option value="all">å…¨éƒ¨äººç‰©</option>
                    <option value="political">æ”¿æ²»å®¶</option>
                    <option value="military">å†›äº‹å®¶</option>
                    <option value="scientist">ç§‘å­¦å®¶</option>
                    <option value="literary">æ–‡å­¦å®¶</option>
                    <option value="philosopher">å“²å­¦å®¶</option>
                </select>
                <!-- æœç´¢è¾“å…¥æ¡†å®¹å™¨ï¼šå§‹ç»ˆæ˜¾ç¤º -->
                <div class="search-container" id="searchContainer">
                    <!-- æœç´¢è¾“å…¥æ¡†ï¼šæœç´¢äº‹ä»¶æˆ–äººç‰© -->
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢äº‹ä»¶æˆ–äººç‰©...">
                    <!-- æœç´¢å›¾æ ‡æŒ‰é’®ï¼šç‚¹å‡»æœç´¢ -->
                    <button class="search-btn" id="searchBtn">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- æ”¾å¤§é•œé•œé¢ï¼šç™½è‰²å¡«å……ï¼Œç°è‰²è¾¹æ¡† -->
                            <circle cx="11" cy="11" r="8" fill="white" stroke="#999" stroke-width="2"/>
                            <!-- æ”¾å¤§é•œæŸ„éƒ¨ï¼šç™½è‰²å¡«å……ï¼Œç°è‰²è¾¹æ¡† -->
                            <line x1="17" y1="17" x2="21" y2="21" stroke="#999" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <!-- ç¼©å°æŒ‰é’®ï¼šç¼©å°æ—¶é—´è½´æ˜¾ç¤º -->
                <button class="nav-btn zoom-btn" id="zoomOutBtn">-</button>
                <!-- ç¼©æ”¾çº§åˆ«æ˜¾ç¤ºï¼šæ˜¾ç¤ºå½“å‰ç¼©æ”¾æ¯”ä¾‹ -->
                <span class="zoom-level" id="zoomLevel">100%</span>
                <!-- æ”¾å¤§æŒ‰é’®ï¼šæ”¾å¤§æ—¶é—´è½´æ˜¾ç¤º -->
                <button class="nav-btn zoom-btn" id="zoomInBtn">+</button>
                <!-- ç™»å½•æŒ‰é’®å®¹å™¨ï¼šåŒ…å«ç™»å½•æŒ‰é’®å’Œç”¨æˆ·èœå• -->
                <div class="login-container">
                    <!-- ç™»å½•æŒ‰é’®ï¼šæ‰“å¼€ç™»å½•å¼¹çª—æˆ–é€€å‡ºç™»å½• -->
                    <button class="nav-btn" id="loginBtn">ç™»å½•</button>
                    <!-- ç”¨æˆ·èœå•å¼¹çª—ï¼šç”¨æˆ·åŠŸèƒ½èœå• -->
                    <div class="user-menu" id="userMenu">
                        <!-- è´¦å·è®¾ç½®ï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ -->
                        <div class="menu-item" id="accountSettings">
                            <span class="menu-icon">âš™ï¸</span>
                            <span class="menu-text">è´¦å·è®¾ç½®</span>
                        </div>
                        <!-- æ”¶è—å†…å®¹ï¼šæŸ¥çœ‹æ”¶è—åˆ—è¡¨ -->
                        <div class="menu-item" id="viewFavorites">
                            <span class="menu-icon">â­</span>
                            <span class="menu-text">æ”¶è—å†…å®¹</span>
                        </div>
                        <!-- æ›´æ¢è´¦æˆ·ï¼šåˆ‡æ¢åˆ°å…¶ä»–è´¦æˆ· -->
                        <div class="menu-item" id="switchAccount">
                            <span class="menu-icon">ğŸ”„</span>
                            <span class="menu-text">æ›´æ¢è´¦æˆ·</span>
                        </div>
                        <!-- é€€å‡ºç™»å½•ï¼šç™»å‡ºå½“å‰ç”¨æˆ· -->
                        <div class="menu-item" id="logoutBtn">
                            <span class="menu-icon">ğŸšª</span>
                            <span class="menu-text">é€€å‡ºç™»å½•</span>
                        </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒºï¼šæ—¶é—´è½´å®¹å™¨ -->
        <main class="main-content">
            <!-- æœªç™»å½•æç¤ºï¼šå½“ç”¨æˆ·æœªç™»å½•æ—¶æ˜¾ç¤º -->
            <div class="no-login" id="noLogin">
                <div class="no-login-content">
                    <div class="no-login-icon">ğŸ”’</div>
                    <h2>è¯·å…ˆç™»å½•</h2>
                    <p>ç™»å½•åå³å¯æµè§ˆå†å²å¹´è¡¨</p>
                    <button class="login-now-btn" id="loginNowBtn">ç«‹å³ç™»å½•</button>
                    <button class="clear-storage-btn" id="clearStorageBtn">æ¸…é™¤ç¼“å­˜</button>
                </div>
            </div>
            <!-- æœç´¢ç»“æœä¸ºç©ºæç¤ºï¼šå½“æœç´¢ä¸åˆ°å†…å®¹æ—¶æ˜¾ç¤º -->
            <div class="no-results" id="noResults">
                <p>æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœã€‚</p>
                <p id="countdownText">5ç§’åè‡ªåŠ¨è¿”å›</p>
            </div>
            <!-- æ—¶é—´è½´å®¹å™¨ï¼šå¯æ¨ªå‘æ»šåŠ¨ -->
            <div class="timeline-container">
                <!-- æ—¶é—´è½´ï¼šåŒ…å«æ‰€æœ‰äº‹ä»¶å¡ç‰‡ -->
                <div class="timeline" id="timeline">
                    <!-- æ—¶é—´è½´çº¿ï¼šä¸­å¤®çš„æ¨ªå‘çº¿æ¡ -->
                    <div class="timeline-line"></div>
                </div>
            </div>
        </main>

        <!-- äººç‰©æ¡£æ¡ˆå¼¹çª—ï¼šæ˜¾ç¤ºäººç‰©è¯¦ç»†ä¿¡æ¯ -->
        <div class="character-modal" id="characterModal">
            <!-- é®ç½©å±‚ï¼šåŠé€æ˜èƒŒæ™¯ï¼Œç‚¹å‡»å¯å…³é—­å¼¹çª— -->
            <div class="modal-overlay" id="modalOverlay"></div>
            <!-- å¼¹çª—å†…å®¹ï¼šäººç‰©ä¿¡æ¯ -->
            <div class="modal-content">
                <!-- å…³é—­æŒ‰é’®ï¼šå…³é—­äººç‰©æ¡£æ¡ˆå¼¹çª— -->
                <button class="modal-close" id="modalClose">&times;</button>
                <!-- äººç‰©ä¿¡æ¯å®¹å™¨ï¼šåŠ¨æ€å¡«å……äººç‰©æ•°æ® -->
                <div class="character-info" id="characterInfo">
                </div>
            </div>
        </div>

        <!-- ç™»å½•å¼¹çª—ï¼šç”¨æˆ·ç™»å½•ç•Œé¢ -->
        <div class="login-modal" id="loginModal">
            <!-- é®ç½©å±‚ï¼šåŠé€æ˜èƒŒæ™¯ï¼Œç‚¹å‡»å¯å…³é—­å¼¹çª— -->
            <div class="modal-overlay" id="loginOverlay"></div>
            <!-- ç™»å½•å†…å®¹ï¼šç™»å½•è¡¨å• -->
            <div class="modal-content login-content">
                <!-- å…³é—­æŒ‰é’®ï¼šå…³é—­ç™»å½•å¼¹çª— -->
                <button class="modal-close" id="loginClose">&times;</button>
                <!-- ç™»å½•æ ‡é¢˜ -->
                <h2>ç”¨æˆ·ç™»å½•</h2>
                <!-- ç™»å½•è¡¨å•ï¼šç”¨æˆ·åå’Œå¯†ç è¾“å…¥ -->
                <form id="loginForm">
                    <!-- ç”¨æˆ·åè¾“å…¥ç»„ -->
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <!-- å¯†ç è¾“å…¥ç»„ -->
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <div class="password-input-wrapper">
                            <input type="password" id="password" name="password" required>
                            <button type="button" class="password-toggle-btn" id="passwordToggleBtn" aria-label="æ˜¾ç¤º/éšè—å¯†ç ">
                                <svg class="eye-icon eye-open" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <ellipse cx="12" cy="12" rx="8" ry="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <svg class="eye-icon eye-closed" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                                    <ellipse cx="12" cy="12" rx="8" ry="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- ç™»å½•æäº¤æŒ‰é’® -->
                    <button type="submit" class="submit-btn">ç™»å½•</button>
                </form>
            </div>
        </div>

        <!-- è´¦å·è®¾ç½®å¼¹çª—ï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ -->
        <div class="account-settings-modal" id="accountSettingsModal">
            <!-- é®ç½©å±‚ï¼šåŠé€æ˜èƒŒæ™¯ï¼Œç‚¹å‡»å¯å…³é—­å¼¹çª— -->
            <div class="modal-overlay" id="accountSettingsOverlay"></div>
            <!-- è´¦å·è®¾ç½®å†…å®¹ï¼šç”¨æˆ·ä¿¡æ¯è¡¨å• -->
            <div class="modal-content account-settings-content">
                <!-- å…³é—­æŒ‰é’®ï¼šå…³é—­è´¦å·è®¾ç½®å¼¹çª— -->
                <button class="modal-close" id="accountSettingsClose">&times;</button>
                <!-- è´¦å·è®¾ç½®æ ‡é¢˜ -->
                <h2>è´¦å·è®¾ç½®</h2>
                <!-- è´¦å·è®¾ç½®è¡¨å• -->
                <form id="accountSettingsForm">
                    <!-- ç”¨æˆ·åæ˜¾ç¤ºç»„ï¼ˆåªè¯»ï¼‰ -->
                    <div class="form-group">
                        <label for="settingsUsername">ç”¨æˆ·å</label>
                        <input type="text" id="settingsUsername" name="username" readonly>
                    </div>
                    <!-- é‚®ç®±è¾“å…¥ç»„ -->
                    <div class="form-group">
                        <label for="settingsEmail">é‚®ç®±</label>
                        <input type="email" id="settingsEmail" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    <!-- æ–°å¯†ç è¾“å…¥ç»„ -->
                    <div class="form-group">
                        <label for="settingsNewPassword">æ–°å¯†ç </label>
                        <input type="password" id="settingsNewPassword" name="newPassword" placeholder="ç•™ç©ºåˆ™ä¸ä¿®æ”¹å¯†ç ">
                    </div>
                    <!-- ç¡®è®¤å¯†ç è¾“å…¥ç»„ -->
                    <div class="form-group">
                        <label for="settingsConfirmPassword">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="settingsConfirmPassword" name="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                    </div>
                    <!-- å¤´åƒé€‰æ‹© -->
                    <div class="form-group">
                        <label>æ›´æ¢å¤´åƒ</label>
                        <div class="avatar-selection">
                            <div class="avatar-option" data-avatar="blue" onclick="selectSettingsAvatar('blue')">
                                <div class="avatar-preview blue-smile">ğŸ˜Š</div>
                            </div>
                            <div class="avatar-option" data-avatar="yellow" onclick="selectSettingsAvatar('yellow')">
                                <div class="avatar-preview yellow-smile">ğŸ˜Š</div>
                            </div>
                            <div class="avatar-option" data-avatar="green" onclick="selectSettingsAvatar('green')">
                                <div class="avatar-preview green-smile">ğŸ˜Š</div>
                            </div>
                            <div class="avatar-option" data-avatar="custom" onclick="document.getElementById('customAvatarInput').click()">
                                <div class="avatar-preview custom-avatar-btn">
                                    <span class="custom-icon">ğŸ“·</span>
                                    <span class="custom-text">è‡ªå®šä¹‰</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="settingsAvatar" name="avatar" value="">
                        <input type="file" id="customAvatarInput" accept="image/*" style="display: none;" onchange="handleCustomAvatar(this)">
                    </div>
                    <!-- ä¿å­˜æŒ‰é’® -->
                    <button type="submit" class="submit-btn">ä¿å­˜</button>
                </form>
            </div>
        </div>
    </div>

    <!-- åŠ è½½å†å²äº‹ä»¶æ•°æ® -->
    <script src="data/events.js"></script>
    <!-- åŠ è½½äººç‰©æ¡£æ¡ˆæ•°æ® -->
    <script src="data/characters.js"></script>
    <!-- åŠ è½½ä¸»é€»è¾‘è„šæœ¬ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ -->
    <script src="timeline-optimized.js"></script>
    <!-- è®¿é—®æ–¹å¼æ£€æµ‹è„šæœ¬ï¼šæç¤ºç”¨æˆ·é€šè¿‡ GitHub Pages åŸŸåè®¿é—® -->
    <script>
        // æ£€æµ‹å½“å‰è®¿é—®æ–¹å¼
        window.addEventListener('load', () => {
            const currentUrl = window.location.href;
            const isGitHubPages = currentUrl.includes('californiafinch.github.io/timeline-app');
            
            // å¦‚æœä¸æ˜¯é€šè¿‡ GitHub Pages åŸŸåè®¿é—®ï¼Œæ˜¾ç¤ºæç¤º
            if (!isGitHubPages) {
                // åˆ›å»ºæç¤ºå…ƒç´ 
                const accessNotice = document.createElement('div');
                accessNotice.style.cssText = `
                    position: fixed;
                    top: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: #4CAF50;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 5px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
                    z-index: 9999;
                    text-align: center;
                    max-width: 90%;
                    font-size: 14px;
                `;
                accessNotice.innerHTML = `
                    <p>ä¸ºäº†è·å¾—æœ€ä½³ä½“éªŒï¼Œè¯·é€šè¿‡ <strong>https://californiafinch.github.io/timeline-app</strong> è®¿é—®æœ¬åº”ç”¨</p>
                    <button style="
                        background-color: white;
                        color: #4CAF50;
                        border: none;
                        padding: 5px 10px;
                        border-radius: 3px;
                        cursor: pointer;
                        margin-top: 10px;
                        font-size: 12px;
                    " onclick="this.parentElement.style.display='none'">å…³é—­</button>
                `;
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(accessNotice);
                
                // 30ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    if (accessNotice.parentNode) {
                        accessNotice.style.display = 'none';
                    }
                }, 30000);
            }
        });
    </script>
    
    <!-- Service Worker æ³¨å†Œè„šæœ¬ï¼šå®ç°ç¦»çº¿æ”¯æŒ -->
    <script>
        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Service Worker
        // æ³¨æ„ï¼šservice-worker.js æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæš‚æ—¶ç¦ç”¨
        /*
        if ('serviceWorker' in navigator) {
            // é¡µé¢åŠ è½½å®Œæˆåæ³¨å†Œ Service Worker
            window.addEventListener('load', () => {
                // æ³¨å†Œ service-worker.js æ–‡ä»¶
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        // æ³¨å†ŒæˆåŠŸï¼Œè¾“å‡ºæ—¥å¿—
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(error => {
                        // æ³¨å†Œå¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
        */
    </script>
</body>
</html>